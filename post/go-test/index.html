<!doctype html><html lang=zh-hans><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.101.0"><link rel=apple-touch-icon sizes=180x180 href=/img/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/img/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/img/favicon-16x16.png><link rel=manifest href=/img/site.webmanifest><link rel=mask-icon href=/img/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><title>Goå•å…ƒæµ‹è¯• - èµµæµ·å®‡çš„åšå®¢</title><meta name=author content="haiyux"><meta name=description content="æ¬¢è¿æ¥åˆ°haiyuxçš„åšå®¢"><meta name=keywords content="golang"><meta property="og:title" content="Goå•å…ƒæµ‹è¯•"><meta name=twitter:title content="Goå•å…ƒæµ‹è¯•"><meta property="og:type" content="article"><meta property="og:url" content="https://www.zhaohaiyu.com/post/go-test/"><meta property="og:description" content="go test go testå‘½ä»¤æ˜¯ä¸€ä¸ªæŒ‰ç…§ä¸€å®šçš„çº¦å®šå’Œç»„ç»‡æ¥æµ‹è¯•ä»£ç çš„ç¨‹åºã€‚åœ¨åŒ…ç›®å½•å†…ï¼Œæ‰€æœ‰ä»¥_test.goä¸ºåç¼€åçš„æºæ–‡ä»¶åœ¨æ‰§è¡Œgo buildæ—¶ä¸ä¼šè¢«æ„å»ºæˆåŒ…çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬æ˜¯go testæµ‹è¯•çš„ä¸€éƒ¨åˆ†ã€‚ go test"><meta name=twitter:description content="go test go testå‘½ä»¤æ˜¯ä¸€ä¸ªæŒ‰ç…§ä¸€å®šçš„çº¦å®šå’Œç»„ç»‡æ¥æµ‹è¯•ä»£ç çš„ç¨‹åºã€‚åœ¨åŒ…ç›®å½•å†…ï¼Œæ‰€æœ‰ä»¥_test.goä¸ºåç¼€åçš„æºæ–‡ä»¶åœ¨æ‰§è¡Œgo buildæ—¶ä¸ä¼šè¢«æ„å»ºæˆåŒ…çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬æ˜¯go testæµ‹è¯•çš„ä¸€éƒ¨åˆ†ã€‚ go test"><meta property="og:image" content="https://www.zhaohaiyu.com/img/favicon-32x32.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.zhaohaiyu.com/img/favicon-32x32.png"><meta property="article:published_time" content="2020-10-28T15:33:45+08:00"><meta property="article:modified_time" content="2020-10-28T15:33:45+08:00"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://www.zhaohaiyu.com/assets/css/fuji.min.css></head><body data-theme=auto data-theme-auto=true><script data-cfasync=false>var fujiThemeData=localStorage.getItem("fuji_data-theme");fujiThemeData?fujiThemeData!=="auto"&&document.body.setAttribute("data-theme",fujiThemeData==="dark"?"dark":"light"):localStorage.setItem("fuji_data-theme","auto")</script><header><div class="container-lg clearfix"><div class="col-12 header"><a class=title-main href=https://www.zhaohaiyu.com>èµµæµ·å®‡çš„åšå®¢</a>
<span class=title-sub>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®,å¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</span></div></div></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h2 class="post-item post-title"><a href=https://www.zhaohaiyu.com/post/go-test/>Goå•å…ƒæµ‹è¯•</a></h2><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2020-10-28</span>
<span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;7792 å­—</span>
<span><i class="iconfont icon-time-sharp"></i>&nbsp;16 åˆ†é’Ÿ</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=/tags/golang>golang</a>&nbsp;</span></div><div class="post-content markdown-body"><h2 id=go-test>go test</h2><p>go testå‘½ä»¤æ˜¯ä¸€ä¸ªæŒ‰ç…§ä¸€å®šçš„çº¦å®šå’Œç»„ç»‡æ¥æµ‹è¯•ä»£ç çš„ç¨‹åºã€‚åœ¨åŒ…ç›®å½•å†…ï¼Œæ‰€æœ‰ä»¥_test.goä¸ºåç¼€åçš„æºæ–‡ä»¶åœ¨æ‰§è¡Œgo buildæ—¶ä¸ä¼šè¢«æ„å»ºæˆåŒ…çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬æ˜¯go testæµ‹è¯•çš„ä¸€éƒ¨åˆ†ã€‚</p><p>go testå‘½ä»¤ä¼šéå†æ‰€æœ‰çš„*_test.goæ–‡ä»¶ä¸­ç¬¦åˆä¸Šè¿°å‘½åè§„åˆ™çš„å‡½æ•°ï¼Œç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„mainåŒ…ç”¨äºè°ƒç”¨ç›¸åº”çš„æµ‹è¯•å‡½æ•°ï¼Œæ¥ç€æ„å»ºå¹¶è¿è¡Œã€æŠ¥å‘Šæµ‹è¯•ç»“æœï¼Œæœ€åæ¸…ç†æµ‹è¯•ä¸­ç”Ÿæˆçš„ä¸´æ—¶æ–‡ä»¶ã€‚</p><p>åœ¨*_test.goæ–‡ä»¶ä¸­æœ‰ä¸‰ç§ç±»å‹çš„å‡½æ•°ï¼Œå•å…ƒæµ‹è¯•å‡½æ•°ã€åŸºå‡†æµ‹è¯•å‡½æ•°å’Œç¤ºä¾‹å‡½æ•°ã€‚</p><table><thead><tr><th>ç±»å‹</th><th>æ ¼å¼</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>æµ‹è¯•å‡½æ•°</td><td>å‡½æ•°åå‰ç¼€ä¸ºTest</td><td>æµ‹è¯•ç¨‹åºçš„ä¸€äº›é€»è¾‘è¡Œä¸ºæ˜¯å¦æ­£ç¡®</td></tr><tr><td>åŸºå‡†å‡½æ•°</td><td>å‡½æ•°åå‰ç¼€ä¸ºBenchmark</td><td>æµ‹è¯•å‡½æ•°çš„æ€§èƒ½</td></tr><tr><td>ç¤ºä¾‹å‡½æ•°</td><td>å‡½æ•°åå‰ç¼€ä¸ºExample</td><td>ä¸ºæ–‡æ¡£æä¾›ç¤ºä¾‹æ–‡æ¡£</td></tr></tbody></table><h2 id=æµ‹è¯•å‡½æ•°>æµ‹è¯•å‡½æ•°</h2><p>æ¯ä¸ªæµ‹è¯•å‡½æ•°å¿…é¡»å¯¼å…¥testingåŒ…ã€‚æµ‹è¯•å‡½æ•°æœ‰å¦‚ä¸‹çš„ç­¾åï¼š</p><pre><code class=language-go>func TestName(t *testing.T) {
    // ...
}
</code></pre><p>æµ‹è¯•å‡½æ•°çš„åå­—å¿…é¡»ä»¥Testå¼€å¤´ï¼Œå¯é€‰çš„åç¼€åå¿…é¡»ä»¥å¤§å†™å­—æ¯å¼€å¤´ï¼š</p><pre><code class=language-go>func TestSin(t *testing.T) { /* ... */ }
func TestCos(t *testing.T) { /* ... */ }
func TestLog(t *testing.T) { /* ... */ }
</code></pre><p>å…¶ä¸­å‚æ•°tç”¨äºæŠ¥å‘Šæµ‹è¯•å¤±è´¥å’Œé™„åŠ çš„æ—¥å¿—ä¿¡æ¯ã€‚testing.Tçš„æ‹¥æœ‰çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func (c *T) Error(args ...interface{})
func (c *T) Errorf(format string, args ...interface{})
func (c *T) Fail()
func (c *T) FailNow()
func (c *T) Failed() bool
func (c *T) Fatal(args ...interface{})
func (c *T) Fatalf(format string, args ...interface{})
func (c *T) Log(args ...interface{})
func (c *T) Logf(format string, args ...interface{})
func (c *T) Name() string
func (t *T) Parallel()
func (t *T) Run(name string, f func(t *T)) bool
func (c *T) Skip(args ...interface{})
func (c *T) SkipNow()
func (c *T) Skipf(format string, args ...interface{})
func (c *T) Skipped() bool
</code></pre><h3 id=æµ‹è¯•å‡½æ•°ç¤ºä¾‹>æµ‹è¯•å‡½æ•°ç¤ºä¾‹</h3><p>å°±åƒç»†èƒæ˜¯æ„æˆæˆ‘ä»¬èº«ä½“çš„åŸºæœ¬å•ä½ï¼Œä¸€ä¸ªè½¯ä»¶ç¨‹åºä¹Ÿæ˜¯ç”±å¾ˆå¤šå•å…ƒç»„ä»¶æ„æˆçš„ã€‚å•å…ƒç»„ä»¶å¯ä»¥æ˜¯å‡½æ•°ã€ç»“æ„ä½“ã€æ–¹æ³•å’Œæœ€ç»ˆç”¨æˆ·å¯èƒ½ä¾èµ–çš„ä»»æ„ä¸œè¥¿ã€‚æ€»ä¹‹æˆ‘ä»¬éœ€è¦ç¡®ä¿è¿™äº›ç»„ä»¶æ˜¯èƒ½å¤Ÿæ­£å¸¸è¿è¡Œçš„ã€‚å•å…ƒæµ‹è¯•æ˜¯ä¸€äº›åˆ©ç”¨å„ç§æ–¹æ³•æµ‹è¯•å•å…ƒç»„ä»¶çš„ç¨‹åºï¼Œå®ƒä¼šå°†ç»“æœä¸é¢„æœŸè¾“å‡ºè¿›è¡Œæ¯”è¾ƒã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªsplitçš„åŒ…ï¼ŒåŒ…ä¸­å®šä¹‰äº†ä¸€ä¸ªSplitå‡½æ•°ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><pre><code class=language-go>// split/split.go
package split
import &quot;strings&quot;
// split package with a single split function.
// Split slices s into all substrings separated by sep and
// returns a slice of the substrings between those separators.
func Split(s, sep string) (result []string) {
	i := strings.Index(s, sep)
	for i &gt; -1 {
		result = append(result, s[:i])
		s = s[i+1:]
		i = strings.Index(s, sep)
	}
	result = append(result, s)
	return
}
</code></pre><p>åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªsplit_test.goçš„æµ‹è¯•æ–‡ä»¶ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªæµ‹è¯•å‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code class=language-go>// split/split_test.go
package split
import (
	&quot;reflect&quot;
	&quot;testing&quot;
)
func TestSplit(t *testing.T) { // æµ‹è¯•å‡½æ•°åå¿…é¡»ä»¥Testå¼€å¤´ï¼Œå¿…é¡»æ¥æ”¶ä¸€ä¸ª*testing.Tç±»å‹å‚æ•°
	got := Split(&quot;ağŸ…±ï¸c&quot;, &quot;:&quot;)         // ç¨‹åºè¾“å‡ºçš„ç»“æœ
	want := []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}    // æœŸæœ›çš„ç»“æœ
	if !reflect.DeepEqual(want, got) { // å› ä¸ºsliceä¸èƒ½æ¯”è¾ƒç›´æ¥ï¼Œå€ŸåŠ©åå°„åŒ…ä¸­çš„æ–¹æ³•æ¯”è¾ƒ
		t.Errorf(&quot;excepted:%v, got:%v&quot;, want, got) // æµ‹è¯•å¤±è´¥è¾“å‡ºé”™è¯¯æç¤º
	}
}
</code></pre><p>æ­¤æ—¶splitè¿™ä¸ªåŒ…ä¸­çš„æ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre><code class=language-bash>split $ ls -l
total 16
-rw-r--r--  1 zhaohaiyu  test  408  4 29 15:50 split.go
-rw-r--r--  1 zhaohaiyu  test  466  4 29 16:04 split_test.go
</code></pre><p>åœ¨splitåŒ…è·¯å¾„ä¸‹ï¼Œæ‰§è¡Œgo testå‘½ä»¤ï¼Œå¯ä»¥çœ‹åˆ°è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=language-bash>split $ go test
PASS
ok     test/split       0.005s
</code></pre><p>ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æœ‰ç‚¹å•è–„ï¼Œæˆ‘ä»¬å†ç¼–å†™ä¸€ä¸ªæµ‹è¯•ä½¿ç”¨å¤šä¸ªå­—ç¬¦åˆ‡å‰²å­—ç¬¦ä¸²çš„ä¾‹å­ï¼Œåœ¨split_test.goä¸­æ·»åŠ å¦‚ä¸‹æµ‹è¯•å‡½æ•°ï¼š</p><pre><code class=language-go>func TestMoreSplit(t *testing.T) {
	got := Split(&quot;abcd&quot;, &quot;bc&quot;)
	want := []string{&quot;a&quot;, &quot;d&quot;}
	if !reflect.DeepEqual(want, got) {
		t.Errorf(&quot;excepted:%v, got:%v&quot;, want, got)
	}
}
</code></pre><p>å†æ¬¡è¿è¡Œgo testå‘½ä»¤ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=language-bash>split $ go test
--- FAIL: TestMultiSplit (0.00s)
    split_test.go:20: excepted:[a d], got:[a cd]
FAIL
exit status 1
FAIL    test/split        0.006s
</code></pre><p>è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å¤±è´¥äº†ã€‚æˆ‘ä»¬å¯ä»¥ä¸ºgo testå‘½ä»¤æ·»åŠ -vå‚æ•°ï¼ŒæŸ¥çœ‹æµ‹è¯•å‡½æ•°åç§°å’Œè¿è¡Œæ—¶é—´ï¼š</p><pre><code class=language-bash>split $ go test -v
=== RUN   TestSplit
--- PASS: TestSplit (0.00s)
=== RUN   TestMoreSplit
--- FAIL: TestMoreSplit (0.00s)
    split_test.go:21: excepted:[a d], got:[a cd]
FAIL
exit status 1
FAIL    test/split        0.005s
</code></pre><p>è¿™ä¸€æ¬¡æˆ‘ä»¬èƒ½æ¸…æ¥šçš„çœ‹åˆ°æ˜¯TestMoreSplitè¿™ä¸ªæµ‹è¯•æ²¡æœ‰æˆåŠŸã€‚ è¿˜å¯ä»¥åœ¨go testå‘½ä»¤åæ·»åŠ -runå‚æ•°ï¼Œå®ƒå¯¹åº”ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæœ‰å‡½æ•°ååŒ¹é…ä¸Šçš„æµ‹è¯•å‡½æ•°æ‰ä¼šè¢«go testå‘½ä»¤æ‰§è¡Œã€‚</p><pre><code class=language-bash>split $ go test -v -run=&quot;More&quot;
=== RUN   TestMoreSplit
--- FAIL: TestMoreSplit (0.00s)
    split_test.go:21: excepted:[a d], got:[a cd]
FAIL
exit status 1
FAIL    test/split       0.006s
</code></pre><p>ç°åœ¨æˆ‘ä»¬å›è¿‡å¤´æ¥è§£å†³æˆ‘ä»¬ç¨‹åºä¸­çš„é—®é¢˜ã€‚å¾ˆæ˜¾ç„¶æˆ‘ä»¬æœ€åˆçš„splitå‡½æ•°å¹¶æ²¡æœ‰è€ƒè™‘åˆ°sepä¸ºå¤šä¸ªå­—ç¬¦çš„æƒ…å†µï¼Œæˆ‘ä»¬æ¥ä¿®å¤ä¸‹è¿™ä¸ªBugï¼š</p><pre><code class=language-go>package split
import &quot;strings&quot;
// split package with a single split function.
// Split slices s into all substrings separated by sep and
// returns a slice of the substrings between those separators.
func Split(s, sep string) (result []string) {
	i := strings.Index(s, sep)
	for i &gt; -1 {
		result = append(result, s[:i])
		s = s[i+len(sep):] // è¿™é‡Œä½¿ç”¨len(sep)è·å–sepçš„é•¿åº¦
		i = strings.Index(s, sep)
	}
	result = append(result, s)
	return
}
</code></pre><p>è¿™ä¸€æ¬¡æˆ‘ä»¬å†æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºã€‚æ³¨æ„ï¼Œå½“æˆ‘ä»¬ä¿®æ”¹äº†æˆ‘ä»¬çš„ä»£ç ä¹‹åä¸è¦ä»…ä»…æ‰§è¡Œé‚£äº›å¤±è´¥çš„æµ‹è¯•å‡½æ•°ï¼Œæˆ‘ä»¬åº”è¯¥å®Œæ•´çš„è¿è¡Œæ‰€æœ‰çš„æµ‹è¯•ï¼Œä¿è¯ä¸ä¼šå› ä¸ºä¿®æ”¹ä»£ç è€Œå¼•å…¥äº†æ–°çš„é—®é¢˜ã€‚</p><pre><code class=language-bash>split $ go test -v
=== RUN   TestSplit
--- PASS: TestSplit (0.00s)
=== RUN   TestMoreSplit
--- PASS: TestMoreSplit (0.00s)
PASS
ok      test/split        0.006s
</code></pre><p>è¿™ä¸€æ¬¡æˆ‘ä»¬çš„æµ‹è¯•éƒ½é€šè¿‡äº†ã€‚</p><h3 id=æµ‹è¯•ç»„>æµ‹è¯•ç»„</h3><p>æˆ‘ä»¬ç°åœ¨è¿˜æƒ³è¦æµ‹è¯•ä¸€ä¸‹splitå‡½æ•°å¯¹ä¸­æ–‡å­—ç¬¦ä¸²çš„æ”¯æŒï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥å†ç¼–å†™ä¸€ä¸ªTestChineseSplitæµ‹è¯•å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ›´å‹å¥½çš„ä¸€ç§æ–¹å¼æ¥æ·»åŠ æ›´å¤šçš„æµ‹è¯•ç”¨ä¾‹ã€‚</p><pre><code class=language-go>func TestSplit(t *testing.T) {
   // å®šä¹‰ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ç±»å‹
	type test struct {
		input string
		sep   string
		want  []string
	}
	// å®šä¹‰ä¸€ä¸ªå­˜å‚¨æµ‹è¯•ç”¨ä¾‹çš„åˆ‡ç‰‡
	tests := []test{
		{input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;:&quot;, want: []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}},
		{input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;,&quot;, want: []string{&quot;ağŸ…±ï¸c&quot;}},
		{input: &quot;abcd&quot;, sep: &quot;bc&quot;, want: []string{&quot;a&quot;, &quot;d&quot;}},
		{input: &quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, sep: &quot;æ²™&quot;, want: []string{&quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}},
	}
	// éå†åˆ‡ç‰‡ï¼Œé€ä¸€æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹
	for _, tc := range tests {
		got := Split(tc.input, tc.sep)
		if !reflect.DeepEqual(got, tc.want) {
			t.Errorf(&quot;excepted:%v, got:%v&quot;, tc.want, got)
		}
	}
}
</code></pre><p>æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„ä»£ç æŠŠå¤šä¸ªæµ‹è¯•ç”¨ä¾‹åˆåˆ°ä¸€èµ·ï¼Œå†æ¬¡æ‰§è¡Œgo testå‘½ä»¤ã€‚</p><pre><code class=language-bash>split $ go test -v
=== RUN   TestSplit
--- FAIL: TestSplit (0.00s)
    split_test.go:42: excepted:[æ²³æœ‰ åˆæœ‰æ²³], got:[ æ²³æœ‰ åˆæœ‰æ²³]
FAIL
exit status 1
FAIL    test/split        0.006s
</code></pre><p>æˆ‘ä»¬çš„æµ‹è¯•å‡ºç°äº†é—®é¢˜ï¼Œä»”ç»†çœ‹æ‰“å°çš„æµ‹è¯•å¤±è´¥æç¤ºä¿¡æ¯ï¼šexcepted:[æ²³æœ‰ åˆæœ‰æ²³], got:[ æ²³æœ‰ åˆæœ‰æ²³]ï¼Œä½ ä¼šå‘ç°[ æ²³æœ‰ åˆæœ‰æ²³]ä¸­æœ‰ä¸ªä¸æ˜æ˜¾çš„ç©ºä¸²ï¼Œè¿™ç§æƒ…å†µä¸‹ååˆ†æ¨èä½¿ç”¨%#vçš„æ ¼å¼åŒ–æ–¹å¼ã€‚</p><p>æˆ‘ä»¬ä¿®æ”¹ä¸‹æµ‹è¯•ç”¨ä¾‹çš„æ ¼å¼åŒ–è¾“å‡ºé”™è¯¯æç¤ºéƒ¨åˆ†ï¼š</p><pre><code class=language-go>func TestSplit(t *testing.T) {
   ...

	for _, tc := range tests {
		got := Split(tc.input, tc.sep)
		if !reflect.DeepEqual(got, tc.want) {
			t.Errorf(&quot;excepted:%#v, got:%#v&quot;, tc.want, got)
		}
	}
}
</code></pre><p>æ­¤æ—¶è¿è¡Œgo testå‘½ä»¤åå°±èƒ½çœ‹åˆ°æ¯”è¾ƒæ˜æ˜¾çš„æç¤ºä¿¡æ¯äº†ï¼š</p><pre><code class=language-bash>split $ go test -v
=== RUN   TestSplit
--- FAIL: TestSplit (0.00s)
    split_test.go:42: excepted:[]string{&quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}, got:[]string{&quot;&quot;, &quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}
FAIL
exit status 1
FAIL    test/split       0.006s
</code></pre><h3 id=å­æµ‹è¯•>å­æµ‹è¯•</h3><p>çœ‹èµ·æ¥éƒ½æŒºä¸é”™çš„ï¼Œä½†æ˜¯å¦‚æœæµ‹è¯•ç”¨ä¾‹æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯æ²¡åŠæ³•ä¸€çœ¼çœ‹å‡ºæ¥å…·ä½“æ˜¯å“ªä¸ªæµ‹è¯•ç”¨ä¾‹å¤±è´¥äº†ã€‚æˆ‘ä»¬å¯èƒ½ä¼šæƒ³åˆ°ä¸‹é¢çš„è§£å†³åŠæ³•ï¼š</p><pre><code class=language-bash>func TestSplit(t *testing.T) {
	type test struct { // å®šä¹‰testç»“æ„ä½“
		input string
		sep   string
		want  []string
	}
	tests := map[string]test{ // æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨mapå­˜å‚¨
		&quot;simple&quot;:      {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;:&quot;, want: []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}},
		&quot;wrong sep&quot;:   {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;,&quot;, want: []string{&quot;ağŸ…±ï¸c&quot;}},
		&quot;more sep&quot;:    {input: &quot;abcd&quot;, sep: &quot;bc&quot;, want: []string{&quot;a&quot;, &quot;d&quot;}},
		&quot;leading sep&quot;: {input: &quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, sep: &quot;æ²™&quot;, want: []string{&quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}},
	}
	for name, tc := range tests {
		got := Split(tc.input, tc.sep)
		if !reflect.DeepEqual(got, tc.want) {
			t.Errorf(&quot;name:%s excepted:%#v, got:%#v&quot;, name, tc.want, got) // å°†æµ‹è¯•ç”¨ä¾‹çš„nameæ ¼å¼åŒ–è¾“å‡º
		}
	}
}
</code></pre><p>ä¸Šé¢çš„åšæ³•æ˜¯èƒ½å¤Ÿè§£å†³é—®é¢˜çš„ã€‚åŒæ—¶Go1.7+ä¸­æ–°å¢äº†å­æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ä½¿ç”¨t.Runæ‰§è¡Œå­æµ‹è¯•ï¼š</p><pre><code class=language-go>func TestSplit(t *testing.T) {
	type test struct { // å®šä¹‰testç»“æ„ä½“
		input string
		sep   string
		want  []string
	}
	tests := map[string]test{ // æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨mapå­˜å‚¨
		&quot;simple&quot;:      {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;:&quot;, want: []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}},
		&quot;wrong sep&quot;:   {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;,&quot;, want: []string{&quot;ağŸ…±ï¸c&quot;}},
		&quot;more sep&quot;:    {input: &quot;abcd&quot;, sep: &quot;bc&quot;, want: []string{&quot;a&quot;, &quot;d&quot;}},
		&quot;leading sep&quot;: {input: &quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, sep: &quot;æ²™&quot;, want: []string{&quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}},
	}
	for name, tc := range tests {
		t.Run(name, func(t *testing.T) { // ä½¿ç”¨t.Run()æ‰§è¡Œå­æµ‹è¯•
			got := Split(tc.input, tc.sep)
			if !reflect.DeepEqual(got, tc.want) {
				t.Errorf(&quot;excepted:%#v, got:%#v&quot;, tc.want, got)
			}
		})
	}
}
</code></pre><p>æ­¤æ—¶æˆ‘ä»¬å†æ‰§è¡Œgo testå‘½ä»¤å°±èƒ½å¤Ÿçœ‹åˆ°æ›´æ¸…æ™°çš„è¾“å‡ºå†…å®¹äº†ï¼š</p><pre><code class=language-bash>split $ go test -v
=== RUN   TestSplit
=== RUN   TestSplit/leading_sep
=== RUN   TestSplit/simple
=== RUN   TestSplit/wrong_sep
=== RUN   TestSplit/more_sep
--- FAIL: TestSplit (0.00s)
    --- FAIL: TestSplit/leading_sep (0.00s)
        split_test.go:83: excepted:[]string{&quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}, got:[]string{&quot;&quot;, &quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}
    --- PASS: TestSplit/simple (0.00s)
    --- PASS: TestSplit/wrong_sep (0.00s)
    --- PASS: TestSplit/more_sep (0.00s)
FAIL
exit status 1
FAIL    test/split       0.006s
</code></pre><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦æŠŠæµ‹è¯•ç”¨ä¾‹ä¸­çš„é”™è¯¯ä¿®æ”¹å›æ¥ï¼š</p><pre><code class=language-go>func TestSplit(t *testing.T) {
	...
	tests := map[string]test{ // æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨mapå­˜å‚¨
		&quot;simple&quot;:      {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;:&quot;, want: []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}},
		&quot;wrong sep&quot;:   {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;,&quot;, want: []string{&quot;ağŸ…±ï¸c&quot;}},
		&quot;more sep&quot;:    {input: &quot;abcd&quot;, sep: &quot;bc&quot;, want: []string{&quot;a&quot;, &quot;d&quot;}},
		&quot;leading sep&quot;: {input: &quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, sep: &quot;æ²™&quot;, want: []string{&quot;&quot;, &quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}},
	}
	...
}
</code></pre><p>æˆ‘ä»¬éƒ½çŸ¥é“å¯ä»¥é€šè¿‡-run=RegExpæ¥æŒ‡å®šè¿è¡Œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿˜å¯ä»¥é€šè¿‡/æ¥æŒ‡å®šè¦è¿è¡Œçš„å­æµ‹è¯•ç”¨ä¾‹ï¼Œä¾‹å¦‚ï¼šgo test -v -run=Split/simpleåªä¼šè¿è¡Œsimpleå¯¹åº”çš„å­æµ‹è¯•ç”¨ä¾‹ã€‚</p><h3 id=æµ‹è¯•è¦†ç›–ç‡>æµ‹è¯•è¦†ç›–ç‡</h3><p>æµ‹è¯•è¦†ç›–ç‡æ˜¯ä½ çš„ä»£ç è¢«æµ‹è¯•å¥—ä»¶è¦†ç›–çš„ç™¾åˆ†æ¯”ã€‚é€šå¸¸æˆ‘ä»¬ä½¿ç”¨çš„éƒ½æ˜¯è¯­å¥çš„è¦†ç›–ç‡ï¼Œä¹Ÿå°±æ˜¯åœ¨æµ‹è¯•ä¸­è‡³å°‘è¢«è¿è¡Œä¸€æ¬¡çš„ä»£ç å æ€»ä»£ç çš„æ¯”ä¾‹ã€‚</p><p>Goæä¾›å†…ç½®åŠŸèƒ½æ¥æ£€æŸ¥ä½ çš„ä»£ç è¦†ç›–ç‡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨go test -coveræ¥æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ã€‚ä¾‹å¦‚ï¼š</p><pre><code class=language-bash>split $ go test -cover
PASS
coverage: 100.0% of statements
ok      test/split       0.005s
</code></pre><p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„æµ‹è¯•ç”¨ä¾‹è¦†ç›–äº†100%çš„ä»£ç ã€‚</p><p>Goè¿˜æä¾›äº†ä¸€ä¸ªé¢å¤–çš„-coverprofileå‚æ•°ï¼Œç”¨æ¥å°†è¦†ç›–ç‡ç›¸å…³çš„è®°å½•ä¿¡æ¯è¾“å‡ºåˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š</p><pre><code class=language-bash>split $ go test -cover -coverprofile=c.out
PASS
coverage: 100.0% of statements
ok      test/split        0.005s
</code></pre><p>ä¸Šé¢çš„å‘½ä»¤ä¼šå°†è¦†ç›–ç‡ç›¸å…³çš„ä¿¡æ¯è¾“å‡ºåˆ°å½“å‰æ–‡ä»¶å¤¹ä¸‹é¢çš„c.outæ–‡ä»¶ä¸­ï¼Œç„¶åæˆ‘ä»¬æ‰§è¡Œgo tool cover -html=c.outï¼Œä½¿ç”¨coverå·¥å…·æ¥å¤„ç†ç”Ÿæˆçš„è®°å½•ä¿¡æ¯ï¼Œè¯¥å‘½ä»¤ä¼šæ‰“å¼€æœ¬åœ°çš„æµè§ˆå™¨çª—å£ç”Ÿæˆä¸€ä¸ªHTMLæŠ¥å‘Šã€‚
<img class=img-zoomable src=/img/2344773-20210819134123814-147476851.png alt>
ä¸Šå›¾ä¸­æ¯ä¸ªç”¨ç»¿è‰²æ ‡è®°çš„è¯­å¥å—è¡¨ç¤ºè¢«è¦†ç›–äº†ï¼Œè€Œçº¢è‰²çš„è¡¨ç¤ºæ²¡æœ‰è¢«è¦†ç›–ã€‚</p><h2 id=åŸºå‡†æµ‹è¯•>åŸºå‡†æµ‹è¯•</h2><h3 id=åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼>åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼</h3><p>åŸºå‡†æµ‹è¯•å°±æ˜¯åœ¨ä¸€å®šçš„å·¥ä½œè´Ÿè½½ä¹‹ä¸‹æ£€æµ‹ç¨‹åºæ€§èƒ½çš„ä¸€ç§æ–¹æ³•ã€‚åŸºå‡†æµ‹è¯•çš„åŸºæœ¬æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func BenchmarkName(b *testing.B){
    // ...
}
</code></pre><p>åŸºå‡†æµ‹è¯•ä»¥Benchmarkä¸ºå‰ç¼€ï¼Œéœ€è¦ä¸€ä¸ª*testing.Bç±»å‹çš„å‚æ•°bï¼ŒåŸºå‡†æµ‹è¯•å¿…é¡»è¦æ‰§è¡Œb.Næ¬¡ï¼Œè¿™æ ·çš„æµ‹è¯•æ‰æœ‰å¯¹ç…§æ€§ï¼Œb.Nçš„å€¼æ˜¯ç³»ç»Ÿæ ¹æ®å®é™…æƒ…å†µå»è°ƒæ•´çš„ï¼Œä»è€Œä¿è¯æµ‹è¯•çš„ç¨³å®šæ€§ã€‚testing.Bæ‹¥æœ‰çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func (c *B) Error(args ...interface{})
func (c *B) Errorf(format string, args ...interface{})
func (c *B) Fail()
func (c *B) FailNow()
func (c *B) Failed() bool
func (c *B) Fatal(args ...interface{})
func (c *B) Fatalf(format string, args ...interface{})
func (c *B) Log(args ...interface{})
func (c *B) Logf(format string, args ...interface{})
func (c *B) Name() string
func (b *B) ReportAllocs()
func (b *B) ResetTimer()
func (b *B) Run(name string, f func(b *B)) bool
func (b *B) RunParallel(body func(*PB))
func (b *B) SetBytes(n int64)
func (b *B) SetParallelism(p int)
func (c *B) Skip(args ...interface{})
func (c *B) SkipNow()
func (c *B) Skipf(format string, args ...interface{})
func (c *B) Skipped() bool
func (b *B) StartTimer()
func (b *B) StopTimer()
</code></pre><h3 id=åŸºå‡†æµ‹è¯•ç¤ºä¾‹>åŸºå‡†æµ‹è¯•ç¤ºä¾‹</h3><p>æˆ‘ä»¬ä¸ºsplitåŒ…ä¸­çš„Splitå‡½æ•°ç¼–å†™åŸºå‡†æµ‹è¯•å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func BenchmarkSplit(b *testing.B) {
	for i := 0; i &lt; b.N; i++ {
		Split(&quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, &quot;æ²™&quot;)
	}
}
</code></pre><p>åŸºå‡†æµ‹è¯•å¹¶ä¸ä¼šé»˜è®¤æ‰§è¡Œï¼Œéœ€è¦å¢åŠ -benchå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ‰§è¡Œgo test -bench=Splitå‘½ä»¤æ‰§è¡ŒåŸºå‡†æµ‹è¯•ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=language-bash>split $ go test -bench=Split
goos: darwin
goarch: amd64
pkg: test/split 
BenchmarkSplit-8        10000000               203 ns/op
PASS
ok      test/split        2.255s
</code></pre><p>å…¶ä¸­BenchmarkSplit-8è¡¨ç¤ºå¯¹Splitå‡½æ•°è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œæ•°å­—8è¡¨ç¤ºGOMAXPROCSçš„å€¼ï¼Œè¿™ä¸ªå¯¹äºå¹¶å‘åŸºå‡†æµ‹è¯•å¾ˆé‡è¦ã€‚10000000å’Œ203ns/opè¡¨ç¤ºæ¯æ¬¡è°ƒç”¨Splitå‡½æ•°è€—æ—¶203nsï¼Œè¿™ä¸ªç»“æœæ˜¯10000000æ¬¡è°ƒç”¨çš„å¹³å‡å€¼ã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥ä¸ºåŸºå‡†æµ‹è¯•æ·»åŠ -benchmemå‚æ•°ï¼Œæ¥è·å¾—å†…å­˜åˆ†é…çš„ç»Ÿè®¡æ•°æ®ã€‚</p><pre><code class=language-bash>split $ go test -bench=Split -benchmem
goos: darwin
goarch: amd64
pkg: test/split 
BenchmarkSplit-8        10000000               215 ns/op             112 B/op          3 allocs/op
PASS
ok      test/split        2.394s
</code></pre><p>å…¶ä¸­ï¼Œ112 B/opè¡¨ç¤ºæ¯æ¬¡æ“ä½œå†…å­˜åˆ†é…äº†112å­—èŠ‚ï¼Œ3 allocs/opåˆ™è¡¨ç¤ºæ¯æ¬¡æ“ä½œè¿›è¡Œäº†3æ¬¡å†…å­˜åˆ†é…ã€‚ æˆ‘ä»¬å°†æˆ‘ä»¬çš„Splitå‡½æ•°ä¼˜åŒ–å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func Split(s, sep string) (result []string) {
	result = make([]string, 0, strings.Count(s, sep)+1)
	i := strings.Index(s, sep)
	for i &gt; -1 {
		result = append(result, s[:i])
		s = s[i+len(sep):] // è¿™é‡Œä½¿ç”¨len(sep)è·å–sepçš„é•¿åº¦
		i = strings.Index(s, sep)
	}
	result = append(result, s)
	return
}
</code></pre><p>è¿™ä¸€æ¬¡æˆ‘ä»¬æå‰ä½¿ç”¨makeå‡½æ•°å°†resultåˆå§‹åŒ–ä¸ºä¸€ä¸ªå®¹é‡è¶³å¤Ÿå¤§çš„åˆ‡ç‰‡ï¼Œè€Œä¸å†åƒä¹‹å‰ä¸€æ ·é€šè¿‡è°ƒç”¨appendå‡½æ•°æ¥è¿½åŠ ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªæ”¹è¿›ä¼šå¸¦æ¥å¤šå¤§çš„æ€§èƒ½æå‡ï¼š</p><pre><code class=language-bash>split $ go test -bench=Split -benchmem
goos: darwin
goarch: amd64
pkg: test/split 
BenchmarkSplit-8        10000000               127 ns/op              48 B/op          1 allocs/op
PASS
ok      test/split        1.423s
</code></pre><p>è¿™ä¸ªä½¿ç”¨makeå‡½æ•°æå‰åˆ†é…å†…å­˜çš„æ”¹åŠ¨ï¼Œå‡å°‘äº†2/3çš„å†…å­˜åˆ†é…æ¬¡æ•°ï¼Œå¹¶ä¸”å‡å°‘äº†ä¸€åŠçš„å†…å­˜åˆ†é…ã€‚</p><h3 id=æ€§èƒ½æ¯”è¾ƒå‡½æ•°>æ€§èƒ½æ¯”è¾ƒå‡½æ•°</h3><p>ä¸Šé¢çš„åŸºå‡†æµ‹è¯•åªèƒ½å¾—åˆ°ç»™å®šæ“ä½œçš„ç»å¯¹è€—æ—¶ï¼Œä½†æ˜¯åœ¨å¾ˆå¤šæ€§èƒ½é—®é¢˜æ˜¯å‘ç”Ÿåœ¨ä¸¤ä¸ªä¸åŒæ“ä½œä¹‹é—´çš„ç›¸å¯¹è€—æ—¶ï¼Œæ¯”å¦‚åŒä¸€ä¸ªå‡½æ•°å¤„ç†1000ä¸ªå…ƒç´ çš„è€—æ—¶ä¸å¤„ç†1ä¸‡ç”šè‡³100ä¸‡ä¸ªå…ƒç´ çš„è€—æ—¶çš„å·®åˆ«æ˜¯å¤šå°‘ï¼Ÿå†æˆ–è€…å¯¹äºåŒä¸€ä¸ªä»»åŠ¡ç©¶ç«Ÿä½¿ç”¨å“ªç§ç®—æ³•æ€§èƒ½æœ€ä½³ï¼Ÿæˆ‘ä»¬é€šå¸¸éœ€è¦å¯¹ä¸¤ä¸ªä¸åŒç®—æ³•çš„å®ç°ä½¿ç”¨ç›¸åŒçš„è¾“å…¥æ¥è¿›è¡ŒåŸºå‡†æ¯”è¾ƒæµ‹è¯•ã€‚</p><p>æ€§èƒ½æ¯”è¾ƒå‡½æ•°é€šå¸¸æ˜¯ä¸€ä¸ªå¸¦æœ‰å‚æ•°çš„å‡½æ•°ï¼Œè¢«å¤šä¸ªä¸åŒçš„Benchmarkå‡½æ•°ä¼ å…¥ä¸åŒçš„å€¼æ¥è°ƒç”¨ã€‚ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func benchmark(b *testing.B, size int){/* ... */}
func Benchmark10(b *testing.B){ benchmark(b, 10) }
func Benchmark100(b *testing.B){ benchmark(b, 100) }
func Benchmark1000(b *testing.B){ benchmark(b, 1000) }
</code></pre><p>ä¾‹å¦‚æˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªè®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code class=language-go>// fib.go
// Fib æ˜¯ä¸€ä¸ªè®¡ç®—ç¬¬nä¸ªæ–æ³¢é‚£å¥‘æ•°çš„å‡½æ•°
func Fib(n int) int {
	if n &lt; 2 {
		return n
	}
	return Fib(n-1) + Fib(n-2)
}
</code></pre><p>æˆ‘ä»¬ç¼–å†™çš„æ€§èƒ½æ¯”è¾ƒå‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code class=language-go>// fib_test.go
func benchmarkFib(b *testing.B, n int) {
	for i := 0; i &lt; b.N; i++ {
		Fib(n)
	}
}
func BenchmarkFib1(b *testing.B)  { benchmarkFib(b, 1) }
func BenchmarkFib2(b *testing.B)  { benchmarkFib(b, 2) }
func BenchmarkFib3(b *testing.B)  { benchmarkFib(b, 3) }
func BenchmarkFib10(b *testing.B) { benchmarkFib(b, 10) }
func BenchmarkFib20(b *testing.B) { benchmarkFib(b, 20) }
func BenchmarkFib40(b *testing.B) { benchmarkFib(b, 40) }
</code></pre><p>è¿è¡ŒåŸºå‡†æµ‹è¯•ï¼š</p><pre><code class=language-bash>split $ go test -bench=.
goos: darwin
goarch: amd64
pkg: test/fib
BenchmarkFib1-8         1000000000               2.03 ns/op
BenchmarkFib2-8         300000000                5.39 ns/op
BenchmarkFib3-8         200000000                9.71 ns/op
BenchmarkFib10-8         5000000               325 ns/op
BenchmarkFib20-8           30000             42460 ns/op
BenchmarkFib40-8               2         638524980 ns/op
PASS
ok      test/fib 12.944s
</code></pre><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªåŸºå‡†æµ‹è¯•è‡³å°‘è¿è¡Œ1ç§’ã€‚å¦‚æœåœ¨Benchmarkå‡½æ•°è¿”å›æ—¶æ²¡æœ‰åˆ°1ç§’ï¼Œåˆ™b.Nçš„å€¼ä¼šæŒ‰1,2,5,10,20,50ï¼Œâ€¦å¢åŠ ï¼Œå¹¶ä¸”å‡½æ•°å†æ¬¡è¿è¡Œã€‚</p><p>æœ€ç»ˆçš„BenchmarkFib40åªè¿è¡Œäº†ä¸¤æ¬¡ï¼Œæ¯æ¬¡è¿è¡Œçš„å¹³å‡å€¼åªæœ‰ä¸åˆ°ä¸€ç§’ã€‚åƒè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥å¯ä»¥ä½¿ç”¨-benchtimeæ ‡å¿—å¢åŠ æœ€å°åŸºå‡†æ—¶é—´ï¼Œä»¥äº§ç”Ÿæ›´å‡†ç¡®çš„ç»“æœã€‚ä¾‹å¦‚ï¼š</p><pre><code class=language-bash>split $ go test -bench=Fib40 -benchtime=20s
goos: darwin
goarch: amd64
pkg: test/fib
BenchmarkFib40-8              50         663205114 ns/op
PASS
ok      test/fib 33.849s
</code></pre><p>è¿™ä¸€æ¬¡BenchmarkFib40å‡½æ•°è¿è¡Œäº†50æ¬¡ï¼Œç»“æœå°±ä¼šæ›´å‡†ç¡®ä¸€äº›äº†ã€‚</p><p>ä½¿ç”¨æ€§èƒ½æ¯”è¾ƒå‡½æ•°åšæµ‹è¯•çš„æ—¶å€™ä¸€ä¸ªå®¹æ˜“çŠ¯çš„é”™è¯¯å°±æ˜¯æŠŠb.Nä½œä¸ºè¾“å…¥çš„å¤§å°ï¼Œä¾‹å¦‚ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­éƒ½æ˜¯é”™è¯¯çš„ç¤ºèŒƒï¼š</p><pre><code class=language-go>// é”™è¯¯ç¤ºèŒƒ1
func BenchmarkFibWrong(b *testing.B) {
	for n := 0; n &lt; b.N; n++ {
		Fib(n)
	}
}
// é”™è¯¯ç¤ºèŒƒ2
func BenchmarkFibWrong2(b *testing.B) {
	Fib(b.N)
}
</code></pre><h3 id=é‡ç½®æ—¶é—´>é‡ç½®æ—¶é—´</h3><p>b.ResetTimerä¹‹å‰çš„å¤„ç†ä¸ä¼šæ”¾åˆ°æ‰§è¡Œæ—¶é—´é‡Œï¼Œä¹Ÿä¸ä¼šè¾“å‡ºåˆ°æŠ¥å‘Šä¸­ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ä¹‹å‰åšä¸€äº›ä¸è®¡åˆ’ä½œä¸ºæµ‹è¯•æŠ¥å‘Šçš„æ“ä½œã€‚ä¾‹å¦‚ï¼š</p><pre><code class=language-go>func BenchmarkSplit(b *testing.B) {
	time.Sleep(5 * time.Second) // å‡è®¾éœ€è¦åšä¸€äº›è€—æ—¶çš„æ— å…³æ“ä½œ
	b.ResetTimer()              // é‡ç½®è®¡æ—¶å™¨
	for i := 0; i &lt; b.N; i++ {
		Split(&quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, &quot;æ²™&quot;)
	}
}
</code></pre><h3 id=å¹¶è¡Œæµ‹è¯•>å¹¶è¡Œæµ‹è¯•</h3><p>func (b *B) RunParallel(body func(*PB))ä¼šä»¥å¹¶è¡Œçš„æ–¹å¼æ‰§è¡Œç»™å®šçš„åŸºå‡†æµ‹è¯•ã€‚</p><p>RunParallelä¼šåˆ›å»ºå‡ºå¤šä¸ªgoroutineï¼Œå¹¶å°†b.Nåˆ†é…ç»™è¿™äº›goroutineæ‰§è¡Œï¼Œ å…¶ä¸­goroutineæ•°é‡çš„é»˜è®¤å€¼ä¸ºGOMAXPROCSã€‚ç”¨æˆ·å¦‚æœæƒ³è¦å¢åŠ éCPUå—é™ï¼ˆnon-CPU-boundï¼‰åŸºå‡†æµ‹è¯•çš„å¹¶è¡Œæ€§ï¼Œ é‚£ä¹ˆå¯ä»¥åœ¨RunParallelä¹‹å‰è°ƒç”¨SetParallelismã€‚RunParallelé€šå¸¸ä¼šä¸-cpuæ ‡å¿—ä¸€åŒä½¿ç”¨ã€‚</p><pre><code class=language-go>func BenchmarkSplitParallel(b *testing.B) {
	// b.SetParallelism(1) // è®¾ç½®ä½¿ç”¨çš„CPUæ•°
	b.RunParallel(func(pb *testing.PB) {
		for pb.Next() {
			Split(&quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, &quot;æ²™&quot;)
		}
	})
}
</code></pre><p>æ‰§è¡Œä¸€ä¸‹åŸºå‡†æµ‹è¯•ï¼š</p><pre><code class=language-bash>split $ go test -bench=.
goos: darwin
goarch: amd64
pkg: test/split 
BenchmarkSplit-8                10000000               131 ns/op
BenchmarkSplitParallel-8        50000000                36.1 ns/op
PASS
ok      test/split        3.308s
</code></pre><p>è¿˜å¯ä»¥é€šè¿‡åœ¨æµ‹è¯•å‘½ä»¤åæ·»åŠ -cpuå‚æ•°å¦‚go test -bench=. -cpu 1æ¥æŒ‡å®šä½¿ç”¨çš„CPUæ•°é‡ã€‚</p><h2 id=setupä¸teardown>Setupä¸TearDown</h2><p>æµ‹è¯•ç¨‹åºæœ‰æ—¶éœ€è¦åœ¨æµ‹è¯•ä¹‹å‰è¿›è¡Œé¢å¤–çš„è®¾ç½®ï¼ˆsetupï¼‰æˆ–åœ¨æµ‹è¯•ä¹‹åè¿›è¡Œæ‹†å¸ï¼ˆteardownï¼‰ã€‚</p><h3 id=testmain>TestMain</h3><p>é€šè¿‡åœ¨*_test.goæ–‡ä»¶ä¸­å®šä¹‰TestMainå‡½æ•°æ¥å¯ä»¥åœ¨æµ‹è¯•ä¹‹å‰è¿›è¡Œé¢å¤–çš„è®¾ç½®ï¼ˆsetupï¼‰æˆ–åœ¨æµ‹è¯•ä¹‹åè¿›è¡Œæ‹†å¸ï¼ˆteardownï¼‰æ“ä½œã€‚</p><p>å¦‚æœæµ‹è¯•æ–‡ä»¶åŒ…å«å‡½æ•°:func TestMain(m *testing.M)é‚£ä¹ˆç”Ÿæˆçš„æµ‹è¯•ä¼šå…ˆè°ƒç”¨ TestMain(m)ï¼Œç„¶åå†è¿è¡Œå…·ä½“æµ‹è¯•ã€‚TestMainè¿è¡Œåœ¨ä¸»goroutineä¸­, å¯ä»¥åœ¨è°ƒç”¨m.Runå‰ååšä»»ä½•è®¾ç½®ï¼ˆsetupï¼‰å’Œæ‹†å¸ï¼ˆteardownï¼‰ã€‚é€€å‡ºæµ‹è¯•çš„æ—¶å€™åº”è¯¥ä½¿ç”¨m.Runçš„è¿”å›å€¼ä½œä¸ºå‚æ•°è°ƒç”¨os.Exitã€‚</p><p>ä¸€ä¸ªä½¿ç”¨TestMainæ¥è®¾ç½®Setupå’ŒTearDownçš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func TestMain(m *testing.M) {
	fmt.Println(&quot;write setup code here...&quot;) // æµ‹è¯•ä¹‹å‰çš„åšä¸€äº›è®¾ç½®
	// å¦‚æœ TestMain ä½¿ç”¨äº† flagsï¼Œè¿™é‡Œåº”è¯¥åŠ ä¸Šflag.Parse()
	retCode := m.Run()                         // æ‰§è¡Œæµ‹è¯•
	fmt.Println(&quot;write teardown code here...&quot;) // æµ‹è¯•ä¹‹ååšä¸€äº›æ‹†å¸å·¥ä½œ
	os.Exit(retCode)                           // é€€å‡ºæµ‹è¯•
}
</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨è°ƒç”¨TestMainæ—¶,flag.Parseå¹¶æ²¡æœ‰è¢«è°ƒç”¨ã€‚æ‰€ä»¥å¦‚æœTestMainä¾èµ–äºcommand-lineæ ‡å¿— (åŒ…æ‹¬ testing åŒ…çš„æ ‡è®°), åˆ™åº”è¯¥æ˜¾ç¤ºçš„è°ƒç”¨flag.Parseã€‚</p><h3 id=å­æµ‹è¯•çš„setupä¸teardown>å­æµ‹è¯•çš„Setupä¸Teardown</h3><p>æœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªæµ‹è¯•é›†è®¾ç½®Setupä¸Teardownï¼Œä¹Ÿæœ‰å¯èƒ½éœ€è¦ä¸ºæ¯ä¸ªå­æµ‹è¯•è®¾ç½®Setupä¸Teardownã€‚ä¸‹é¢æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå‡½æ•°å·¥å…·å‡½æ•°å¦‚ä¸‹ï¼š</p><pre><code class=language-go>// æµ‹è¯•é›†çš„Setupä¸Teardown
func setupTestCase(t *testing.T) func(t *testing.T) {
	t.Log(&quot;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹å‰çš„setup&quot;)
	return func(t *testing.T) {
		t.Log(&quot;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹åçš„teardown&quot;)
	}
}
// å­æµ‹è¯•çš„Setupä¸Teardown
func setupSubTest(t *testing.T) func(t *testing.T) {
	t.Log(&quot;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup&quot;)
	return func(t *testing.T) {
		t.Log(&quot;å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown&quot;)
	}
}
</code></pre><p>ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func TestSplit(t *testing.T) {
	type test struct { // å®šä¹‰testç»“æ„ä½“
		input string
		sep   string
		want  []string
	}
	tests := map[string]test{ // æµ‹è¯•ç”¨ä¾‹ä½¿ç”¨mapå­˜å‚¨
		&quot;simple&quot;:      {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;:&quot;, want: []string{&quot;a&quot;, &quot;b&quot;, &quot;c&quot;}},
		&quot;wrong sep&quot;:   {input: &quot;ağŸ…±ï¸c&quot;, sep: &quot;,&quot;, want: []string{&quot;ağŸ…±ï¸c&quot;}},
		&quot;more sep&quot;:    {input: &quot;abcd&quot;, sep: &quot;bc&quot;, want: []string{&quot;a&quot;, &quot;d&quot;}},
		&quot;leading sep&quot;: {input: &quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, sep: &quot;æ²™&quot;, want: []string{&quot;&quot;, &quot;æ²³æœ‰&quot;, &quot;åˆæœ‰æ²³&quot;}},
	}
	teardownTestCase := setupTestCase(t) // æµ‹è¯•ä¹‹å‰æ‰§è¡Œsetupæ“ä½œ
	defer teardownTestCase(t)            // æµ‹è¯•ä¹‹åæ‰§è¡Œtestdoenæ“ä½œ
	for name, tc := range tests {
		t.Run(name, func(t *testing.T) { // ä½¿ç”¨t.Run()æ‰§è¡Œå­æµ‹è¯•
			teardownSubTest := setupSubTest(t) // å­æµ‹è¯•ä¹‹å‰æ‰§è¡Œsetupæ“ä½œ
			defer teardownSubTest(t)           // æµ‹è¯•ä¹‹åæ‰§è¡Œtestdoenæ“ä½œ
			got := Split(tc.input, tc.sep)
			if !reflect.DeepEqual(got, tc.want) {
				t.Errorf(&quot;excepted:%#v, got:%#v&quot;, tc.want, got)
			}
		})
	}
}
</code></pre><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><pre><code class=language-bash>split $ go test -v
=== RUN   TestSplit
=== RUN   TestSplit/simple
=== RUN   TestSplit/wrong_sep
=== RUN   TestSplit/more_sep
=== RUN   TestSplit/leading_sep
--- PASS: TestSplit (0.00s)
    split_test.go:71: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹å‰çš„setup
    --- PASS: TestSplit/simple (0.00s)
        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
    --- PASS: TestSplit/wrong_sep (0.00s)
        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
    --- PASS: TestSplit/more_sep (0.00s)
        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
    --- PASS: TestSplit/leading_sep (0.00s)
        split_test.go:79: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹å‰çš„setup
        split_test.go:81: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:å­æµ‹è¯•ä¹‹åçš„teardown
    split_test.go:73: å¦‚æœ‰éœ€è¦åœ¨æ­¤æ‰§è¡Œ:æµ‹è¯•ä¹‹åçš„teardown
=== RUN   ExampleSplit
--- PASS: ExampleSplit (0.00s)
PASS
ok      test/split        0.006s
</code></pre><h2 id=ç¤ºä¾‹å‡½æ•°>ç¤ºä¾‹å‡½æ•°</h2><h3 id=ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼>ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼</h3><p>è¢«go testç‰¹æ®Šå¯¹å¾…çš„ç¬¬ä¸‰ç§å‡½æ•°å°±æ˜¯ç¤ºä¾‹å‡½æ•°ï¼Œå®ƒä»¬çš„å‡½æ•°åä»¥Exampleä¸ºå‰ç¼€ã€‚å®ƒä»¬æ—¢æ²¡æœ‰å‚æ•°ä¹Ÿæ²¡æœ‰è¿”å›å€¼ã€‚æ ‡å‡†æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code class=language-go>func ExampleName() {
    // ...
}
</code></pre><h3 id=ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹>ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹</h3><p>ä¸‹é¢çš„ä»£ç æ˜¯æˆ‘ä»¬ä¸ºSplitå‡½æ•°ç¼–å†™çš„ä¸€ä¸ªç¤ºä¾‹å‡½æ•°ï¼š</p><pre><code class=language-go>func ExampleSplit() {
	fmt.Println(split.Split(&quot;ağŸ…±ï¸c&quot;, &quot;:&quot;))
	fmt.Println(split.Split(&quot;æ²™æ²³æœ‰æ²™åˆæœ‰æ²³&quot;, &quot;æ²™&quot;))
	// Output:
	// [a b c]
	// [ æ²³æœ‰ åˆæœ‰æ²³]
}
</code></pre><p>ä¸ºä½ çš„ä»£ç ç¼–å†™ç¤ºä¾‹ä»£ç æœ‰å¦‚ä¸‹ä¸‰ä¸ªç”¨å¤„ï¼š</p><ol><li><p>ç¤ºä¾‹å‡½æ•°èƒ½å¤Ÿä½œä¸ºæ–‡æ¡£ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚åŸºäºwebçš„godocä¸­èƒ½æŠŠç¤ºä¾‹å‡½æ•°ä¸å¯¹åº”çš„å‡½æ•°æˆ–åŒ…ç›¸å…³è”ã€‚</p></li><li><p>ç¤ºä¾‹å‡½æ•°åªè¦åŒ…å«äº†// Output:ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡go testè¿è¡Œçš„å¯æ‰§è¡Œæµ‹è¯•ã€‚</p><pre><code class=language-bash>split $ go test -run Example
PASS
ok      test/split        0.006s
</code></pre></li><li><p>ç¤ºä¾‹å‡½æ•°æä¾›äº†å¯ä»¥ç›´æ¥è¿è¡Œçš„ç¤ºä¾‹ä»£ç ï¼Œå¯ä»¥ç›´æ¥åœ¨golang.orgçš„godocæ–‡æ¡£æœåŠ¡å™¨ä¸Šä½¿ç”¨Go Playgroundè¿è¡Œç¤ºä¾‹ä»£ç ã€‚ä¸‹å›¾ä¸ºstrings.ToUpperå‡½æ•°åœ¨Playgroundçš„ç¤ºä¾‹å‡½æ•°æ•ˆæœã€‚![Go Playground]<img class=img-zoomable src=/images/877190903_1600072014345_9B81FBE536826F0B4110CAC9E05372C2.png alt></p></li></ol><p>å‚è€ƒæ–‡ç« :</p><ul><li>ã€Šgoè¯­è¨€åœ£ç»ã€‹</li><li><a href=https://www.liwenzhou.com/posts/Go/16_test/ target=_blank>https://www.liwenzhou.com/posts/Go/16_test/</a></li></ul></div></article><div class="license markdown-body"><blockquote><p>é™¤ç‰¹æ®Šæ³¨æ˜éƒ¨åˆ†ï¼Œæœ¬ç«™å†…å®¹é‡‡ç”¨ <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/ target=_blank>CC BY-NC-SA 4.0</a> è¿›è¡Œè®¸å¯ã€‚</p></blockquote></div><div class=post-comment data-comment=utterances><span class=post-comment-notloaded><i class="iconfont icon-chatbox-ellipses-sharp"></i>&nbsp;æŸ¥çœ‹è¯„è®º</span>
<script>function loadComment(){var e,n=document.querySelector(".post-comment"),t=document.body.getAttribute("data-theme");t==="auto"?t=window.matchMedia("(prefers-color-scheme: dark)").matches?"photon-dark":"github-light":t=t==="dark"?"photon-dark":"github-light",e=document.createElement("script"),e.src="https://utteranc.es/client.js",e.setAttribute("repo","haiyux/haiyux.github.io"),e.setAttribute("issue-term","pathname"),e.setAttribute("theme",t),e.setAttribute("crossorigin","anonymous"),e.setAttribute("async",""),document.querySelector(".post-comment").appendChild(e),document.querySelector("span.post-comment-notloaded").setAttribute("style","display: none;")}</script></div></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>é¡µé¢</h3><ul><li><a href=/>ä¸»é¡µ</a></li><li><a href=/archives/>æ–‡ç« </a></li><li><a href=/about/>å…³äº</a></li><li><a href=/search/>æœç´¢</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>é“¾æ¥</h3><ul><li><a href=https://github.com/haiyux target=_blank><span>GitHub</span></a></li><li><a href=https://go-kratos.dev target=_blank><span>Kratos</span></a></li><li><a href=https://farer.org/ target=_blank><span>Windfarer</span></a></li><li><a href=https://www.liwenzhou.com/ target=_blank><span>ææ–‡å‘¨</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>æ ‡ç­¾</h3><div><span><a href=/tags/ddd/>DDD</a></span>
<span><a href=/tags/docker/>docker</a></span>
<span><a href=/tags/golang/>golang</a></span>
<span><a href=/tags/grpc/>grpc</a></span>
<span><a href=/tags/http/>http</a></span>
<span><a href=/tags/kratos/>kratos</a></span>
<span><a href=/tags/makefile/>makefile</a></span>
<span><a href=/tags/mq/>mq</a></span>
<span><a href=/tags/mysql/>mysql</a></span>
<span><a href=/tags/nginx/>nginx</a></span>
<span><a href=/tags/protobuf/>protobuf</a></span>
<span><a href=/tags/raft/>raft</a></span>
<span><a href=/tags/redis/>redis</a></span>
<span><a href=/tags/thrift/>Thrift</a></span>
<span><a href=/tags/traceing/>traceing</a></span>
<span><a href=/tags/wire/>wire</a></span>
<span><a href=/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/>å¾®æœåŠ¡</a></span>
<span><a href=/tags/%E6%B3%9B%E5%9E%8B/>æ³›å‹</a></span>
<span><a href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>è®¾è®¡æ¨¡å¼</a></span>
<span><a href=/tags/%E8%BF%90%E7%BB%B4/>è¿ç»´</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>ç›®å½•</h3><nav id=TableOfContents><ul><li><a href=#go-test>go test</a></li><li><a href=#æµ‹è¯•å‡½æ•°>æµ‹è¯•å‡½æ•°</a><ul><li><a href=#æµ‹è¯•å‡½æ•°ç¤ºä¾‹>æµ‹è¯•å‡½æ•°ç¤ºä¾‹</a></li><li><a href=#æµ‹è¯•ç»„>æµ‹è¯•ç»„</a></li><li><a href=#å­æµ‹è¯•>å­æµ‹è¯•</a></li><li><a href=#æµ‹è¯•è¦†ç›–ç‡>æµ‹è¯•è¦†ç›–ç‡</a></li></ul></li><li><a href=#åŸºå‡†æµ‹è¯•>åŸºå‡†æµ‹è¯•</a><ul><li><a href=#åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼>åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼</a></li><li><a href=#åŸºå‡†æµ‹è¯•ç¤ºä¾‹>åŸºå‡†æµ‹è¯•ç¤ºä¾‹</a></li><li><a href=#æ€§èƒ½æ¯”è¾ƒå‡½æ•°>æ€§èƒ½æ¯”è¾ƒå‡½æ•°</a></li><li><a href=#é‡ç½®æ—¶é—´>é‡ç½®æ—¶é—´</a></li><li><a href=#å¹¶è¡Œæµ‹è¯•>å¹¶è¡Œæµ‹è¯•</a></li></ul></li><li><a href=#setupä¸teardown>Setupä¸TearDown</a><ul><li><a href=#testmain>TestMain</a></li><li><a href=#å­æµ‹è¯•çš„setupä¸teardown>å­æµ‹è¯•çš„Setupä¸Teardown</a></li></ul></li><li><a href=#ç¤ºä¾‹å‡½æ•°>ç¤ºä¾‹å‡½æ•°</a><ul><li><a href=#ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼>ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼</a></li><li><a href=#ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹>ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹</a></li></ul></li></ul></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>é¡µé¢</h3><ul><li><a href=/>ä¸»é¡µ</a></li><li><a href=/archives/>æ–‡ç« </a></li><li><a href=/about/>å…³äº</a></li><li><a href=/search/>æœç´¢</a></li><li><a href=/index.xml>RSS</a></li></ul></div><div class="sidebar-item sidebar-links"><h3>é“¾æ¥</h3><ul><li><a href=https://github.com/haiyux target=_blank><span>GitHub</span></a></li><li><a href=https://go-kratos.dev target=_blank><span>Kratos</span></a></li><li><a href=https://farer.org/ target=_blank><span>Windfarer</span></a></li><li><a href=https://www.liwenzhou.com/ target=_blank><span>ææ–‡å‘¨</span></a></li></ul></div><div class="sidebar-item sidebar-tags"><h3>æ ‡ç­¾</h3><div><span><a href=/tags/ddd/>DDD</a></span>
<span><a href=/tags/docker/>docker</a></span>
<span><a href=/tags/golang/>golang</a></span>
<span><a href=/tags/grpc/>grpc</a></span>
<span><a href=/tags/http/>http</a></span>
<span><a href=/tags/kratos/>kratos</a></span>
<span><a href=/tags/makefile/>makefile</a></span>
<span><a href=/tags/mq/>mq</a></span>
<span><a href=/tags/mysql/>mysql</a></span>
<span><a href=/tags/nginx/>nginx</a></span>
<span><a href=/tags/protobuf/>protobuf</a></span>
<span><a href=/tags/raft/>raft</a></span>
<span><a href=/tags/redis/>redis</a></span>
<span><a href=/tags/thrift/>Thrift</a></span>
<span><a href=/tags/traceing/>traceing</a></span>
<span><a href=/tags/wire/>wire</a></span>
<span><a href=/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/>å¾®æœåŠ¡</a></span>
<span><a href=/tags/%E6%B3%9B%E5%9E%8B/>æ³›å‹</a></span>
<span><a href=/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/>è®¾è®¡æ¨¡å¼</a></span>
<span><a href=/tags/%E8%BF%90%E7%BB%B4/>è¿ç»´</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>ç›®å½•</h3><nav id=TableOfContents><ul><li><a href=#go-test>go test</a></li><li><a href=#æµ‹è¯•å‡½æ•°>æµ‹è¯•å‡½æ•°</a><ul><li><a href=#æµ‹è¯•å‡½æ•°ç¤ºä¾‹>æµ‹è¯•å‡½æ•°ç¤ºä¾‹</a></li><li><a href=#æµ‹è¯•ç»„>æµ‹è¯•ç»„</a></li><li><a href=#å­æµ‹è¯•>å­æµ‹è¯•</a></li><li><a href=#æµ‹è¯•è¦†ç›–ç‡>æµ‹è¯•è¦†ç›–ç‡</a></li></ul></li><li><a href=#åŸºå‡†æµ‹è¯•>åŸºå‡†æµ‹è¯•</a><ul><li><a href=#åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼>åŸºå‡†æµ‹è¯•å‡½æ•°æ ¼å¼</a></li><li><a href=#åŸºå‡†æµ‹è¯•ç¤ºä¾‹>åŸºå‡†æµ‹è¯•ç¤ºä¾‹</a></li><li><a href=#æ€§èƒ½æ¯”è¾ƒå‡½æ•°>æ€§èƒ½æ¯”è¾ƒå‡½æ•°</a></li><li><a href=#é‡ç½®æ—¶é—´>é‡ç½®æ—¶é—´</a></li><li><a href=#å¹¶è¡Œæµ‹è¯•>å¹¶è¡Œæµ‹è¯•</a></li></ul></li><li><a href=#setupä¸teardown>Setupä¸TearDown</a><ul><li><a href=#testmain>TestMain</a></li><li><a href=#å­æµ‹è¯•çš„setupä¸teardown>å­æµ‹è¯•çš„Setupä¸Teardown</a></li></ul></li><li><a href=#ç¤ºä¾‹å‡½æ•°>ç¤ºä¾‹å‡½æ•°</a><ul><li><a href=#ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼>ç¤ºä¾‹å‡½æ•°çš„æ ¼å¼</a></li><li><a href=#ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹>ç¤ºä¾‹å‡½æ•°ç¤ºä¾‹</a></li></ul></li></ul></nav></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><span>&copy; 2019-2022
<a href=https://www.zhaohaiyu.com>haiyux</a>
| <a href=https://github.com/haiyux/haiyux.github.io>Source code</a>
| åŸºäº <a href=https://github.com/dsrkafuu/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a> æ„å»º</span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/components/prism-core.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=/assets/js/fuji.min.js></script></body></html>