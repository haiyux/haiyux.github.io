<!DOCTYPE html>
<html lang="zh-hans">

<head>
    
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
<meta name="HandheldFriendly" content="True" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<meta name="generator" content="Hugo 0.100.1" />


<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/img/site.webmanifest">
<link rel="mask-icon" href="/img/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">


<title>é€šè¿‡ layout æ¢ç´¢ kratos è¿è¡ŒåŸç† - èµµæµ·å®‡çš„åšå®¢</title>


<meta name="author" content="haiyux" />


<meta name="description" content="æ¬¢è¿æ¥åˆ°haiyuxçš„åšå®¢" />



<meta property="og:title" content="é€šè¿‡ layout æ¢ç´¢ kratos è¿è¡ŒåŸç†" />
<meta name="twitter:title" content="é€šè¿‡ layout æ¢ç´¢ kratos è¿è¡ŒåŸç†" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.zhaohaiyu.com/post/kratos-layout/" /><meta property="og:description" content="åˆ›å»ºé¡¹ç›® é¦–å…ˆéœ€è¦å®‰è£…å¥½å¯¹åº”çš„ä¾èµ–ç¯å¢ƒï¼Œä»¥åŠå·¥å…·ï¼š go ä¸‹è½½ protoc go install google.golang.org/protobuf/cmd/protoc-gen-go@latest protoc-gen-go go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest # åˆ›å»ºé¡¹ç›®æ¨¡æ¿ kratos new helloworld cd helloworld # æ‹‰å–é¡¹ç›®ä¾èµ– go mod download # ç”Ÿæˆprotoæ¨¡æ¿ kratos proto add api/helloworld/helloworld.proto # ç”Ÿæˆprotoæºç  kratos proto client api/helloworld/helloworld.proto # ç”Ÿæˆserveræ¨¡æ¿ kratos proto server api/helloworld/helloworld.proto" />
<meta name="twitter:description" content="åˆ›å»ºé¡¹ç›® é¦–å…ˆéœ€è¦å®‰è£…å¥½å¯¹åº”çš„ä¾èµ–ç¯å¢ƒï¼Œä»¥åŠå·¥å…·ï¼š go ä¸‹è½½ protoc go install google.golang.org/protobuf/cmd/protoc-gen-go@latest protoc-gen-go go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest # åˆ›å»ºé¡¹ç›®æ¨¡æ¿ kratos new helloworld cd helloworld # æ‹‰å–é¡¹ç›®ä¾èµ– go mod download # ç”Ÿæˆprotoæ¨¡æ¿ kratos proto add api/helloworld/helloworld.proto # ç”Ÿæˆprotoæºç  kratos proto client api/helloworld/helloworld.proto # ç”Ÿæˆserveræ¨¡æ¿ kratos proto server api/helloworld/helloworld.proto" /><meta property="og:image" content="https://www.zhaohaiyu.com/img/favicon-32x32.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://www.zhaohaiyu.com/img/favicon-32x32.png" /><meta property="article:published_time" content="2021-10-02T18:03:24+08:00" /><meta property="article:modified_time" content="2021-10-02T18:03:24+08:00" />


<style>
    @media (prefers-color-scheme: dark) {
        body[data-theme='auto'] img {
            filter: brightness(60%);
        }
    }

    body[data-theme='dark'] img {
        filter: brightness(60%);
    }
</style>




<link rel="stylesheet" href="https://www.zhaohaiyu.com/assets/css/fuji.min.css" />








</head>

<body
  data-theme="auto"
  data-theme-auto='true'
  >
    <script data-cfasync="false">
  
  var fujiThemeData = localStorage.getItem('fuji_data-theme');
  
  if (!fujiThemeData) {
    localStorage.setItem('fuji_data-theme', 'auto');
  } else {
    
    if (fujiThemeData !== 'auto') {
      document.body.setAttribute('data-theme', fujiThemeData === 'dark' ? 'dark' : 'light');
    }
  }
</script>

    <header>
    <div class="container-lg clearfix">
        <div class="col-12 header">
            <a class="title-main" href="https://www.zhaohaiyu.com">èµµæµ·å®‡çš„åšå®¢</a>
            
            <span class="title-sub">è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®,å¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</span>
            
        </div>
    </div>
</header>

    <main>
        <div class="container-lg clearfix">
            
            <div class="col-12 col-md-9 float-left content">
                
<article>
    
    <h2 class="post-item post-title">
        <a href="https://www.zhaohaiyu.com/post/kratos-layout/">é€šè¿‡ layout æ¢ç´¢ kratos è¿è¡ŒåŸç†</a>
    </h2>
    <div class="post-item post-meta">
        <span><i class="iconfont icon-today-sharp"></i>&nbsp;2021-10-02</span>

<span><i class="iconfont icon-file-tray-sharp"></i>&nbsp;1158 å­—</span>
<span><i class="iconfont icon-time-sharp"></i>&nbsp;3 åˆ†é’Ÿ</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;æ— æ ‡ç­¾</span>

    </div>
    
    <div class="post-content markdown-body">
        <h2 id="åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</h2>
<p>é¦–å…ˆéœ€è¦å®‰è£…å¥½å¯¹åº”çš„ä¾èµ–ç¯å¢ƒï¼Œä»¥åŠå·¥å…·ï¼š</p>
<ol>
<li>go
<ul>
<li><a href="https://studygolang.com/dl" target="_blank">ä¸‹è½½</a></li>
</ul>
</li>
<li>protoc
<ul>
<li><code>go install google.golang.org/protobuf/cmd/protoc-gen-go@latest</code></li>
</ul>
</li>
<li>protoc-gen-go
<ul>
<li><code>go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest</code></li>
</ul>
</li>
</ol>
<pre><code class="language-bash"># åˆ›å»ºé¡¹ç›®æ¨¡æ¿
kratos new helloworld

cd helloworld
# æ‹‰å–é¡¹ç›®ä¾èµ–
go mod download
# ç”Ÿæˆprotoæ¨¡æ¿
kratos proto add api/helloworld/helloworld.proto
# ç”Ÿæˆprotoæºç 
kratos proto client api/helloworld/helloworld.proto
# ç”Ÿæˆserveræ¨¡æ¿
kratos proto server api/helloworld/helloworld.proto -t internal/service
</code></pre>
<p>æ‰§è¡Œå‘½ä»¤å,ä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ª service å·¥ç¨‹,å·¥ç¨‹éª¨æ¶å¦‚ä¸‹,å…·ä½“çš„å·¥ç¨‹éª¨æ¶è¯´æ˜å¯ä»¥è®¿é—® <a href="https://go-kratos.dev/docs/intro/layout" target="_blank">layout</a></p>
<p><img class="img-zoomable" src="/images/2344773-20210902224825993-166434377.png" alt="" />
</p>
<h2 id="è¿è¡Œé¡¹ç›®">è¿è¡Œé¡¹ç›®</h2>
<pre><code class="language-shell"># ç”Ÿæˆæ‰€æœ‰protoæºç ã€wireç­‰ç­‰
go generate ./...

# ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶
go build -o ./bin/ ./...

# è¿è¡Œé¡¹ç›®
./bin/helloworld -conf ./configs
</code></pre>
<p>çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºåˆ™è¯æ˜é¡¹ç›®å¯åŠ¨æ­£å¸¸</p>
<pre><code class="language-bash">level=INFO module=app service_id=7114ad8a-b3bf-11eb-a1b9-f0189850d2cb service_name=  version=
level=INFO module=transport/grpc msg=[gRPC] server listening on: [::]:9000
level=INFO module=transport/http msg=[HTTP] server listening on: [::]:8000 
</code></pre>
<p>æµ‹è¯•æ¥å£</p>
<pre><code class="language-shell">curl 'http://127.0.0.1:8000/helloworld/krtaos'

è¾“å‡ºï¼š
{
  &quot;message&quot;: &quot;Hello kratos&quot;
}
</code></pre>
<h2 id="åº”ç”¨æ˜¯å¦‚ä½•è·‘èµ·æ¥çš„">åº”ç”¨æ˜¯å¦‚ä½•è·‘èµ·æ¥çš„?</h2>
<p><img class="img-zoomable" src="/images/2344773-20210902224841022-2051641947.png" alt="" />
</p>
<p>é€šè¿‡ä¸Šé¢çš„å›¾ä¾‹ğŸ‘†,æˆ‘ä»¬å¯ä»¥ç›´è§‚è§‚å¯Ÿåˆ°åº”ç”¨çš„è°ƒç”¨é“¾,ç®€åŒ–æ¥è¯´å¦‚ä¸‹å›¾æµç¨‹æ‰€ç¤ºğŸ‘‡</p>
<p><img class="img-zoomable" src="/images/2344773-20210902224857367-1591524951.png" alt="" />
</p>
<h3 id="1-æ³¨å…¥ä¾èµ–å¹¶è°ƒç”¨-newapp-æ–¹æ³•">1. æ³¨å…¥ä¾èµ–å¹¶è°ƒç”¨ newApp() æ–¹æ³•</h3>
<pre><code class="language-go">// helloword/cmd/main.go
func main() {
    flag.Parse()
    logger := log.NewStdLogger(os.Stdout)

    // è°ƒç”¨ go-kratos/kratos/v2/config,åˆ›å»º config å®ä¾‹,å¹¶æŒ‡å®šäº†æ¥æºå’Œé…ç½®è§£ææ–¹æ³•
    c := config.New(
    config.WithSource(
        file.NewSource(flagconf),
    ),
    config.WithDecoder(func(kv *config.KeyValue, v map[string]interface{}) error {
        return yaml.Unmarshal(kv.Value, v)
    }),
    )
    if err := c.Load(); err != nil {
        panic(err)
    }

    // å°†é…ç½®æ‰«æåˆ°,é€šè¿‡ proto å£°æ˜çš„ conf struct ä¸Š
    var bc conf.Bootstrap
    if err := c.Scan(&amp;bc); err != nil {
        panic(err)
    }

    // é€šè¿‡ wire å°†ä¾èµ–æ³¨å…¥,å¹¶è°ƒç”¨ newApp æ–¹æ³•
    app, cleanup, err := initApp(bc.Server, bc.Data, logger)
    if err != nil {
        panic(err)
    }
    // çœç•¥ä»£ç ...
}
</code></pre>
<h3 id="2-åˆ›å»º-kratos-å®ä¾‹">2. åˆ›å»º kratos å®ä¾‹</h3>
<p>é¡¹ç›® main.go çš„ <strong>newApp()</strong> æ–¹æ³•ä¸­,è°ƒç”¨äº† <strong>go-kratos/kratos/v2/app.go</strong> ä¸­çš„ <strong>kratos.New()</strong> æ–¹æ³•</p>
<pre><code class="language-go">// helloword/cmd/main.go
func newApp(logger log.Logger, hs *http.Server, gs *grpc.Server) *kratos.App {
    return kratos.New(
        // é…ç½®åº”ç”¨   
        kratos.Name(Name),
        kratos.Version(Version),
        kratos.Metadata(map[string]string{}),
        kratos.Logger(logger),
        // kratos.Server() ä¼ å…¥çš„ http/grpc æœåŠ¡ä¼šé€šè¿‡ buildInstance() è½¬æ¢æˆregistry.ServiceInstance struct*
        kratos.Server(
            hs,
            gs,
        ),
    )
}
</code></pre>
<p>è¯¥æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª <strong>App struct</strong>,åŒ…å« <strong>Run()</strong> å’Œ <strong>Stop()</strong> æ–¹æ³•</p>
<pre><code class="language-go">// go-kratos/kratos/v2/app.go
type App struct {
    opts     options //é…ç½®
    ctx      context.Context // ä¸Šä¸‹æ–‡
    cancel   func() // context çš„å–æ¶ˆæ–¹æ³•
    instance *registry.ServiceInstance //é€šè¿‡ kratos.Server()å£°æ˜çš„å®ä¾‹,å¹¶é€šè¿‡ buildInstance() è½¬æ¢åçš„ *registry.ServiceInstance struct
    log      *log.Helper // æ—¥å¿—
}

// Run executes all OnStart hooks registered with the application's Lifecycle.
func (a *App) Run() error {
    // çœç•¥ä»£ç ...
}

// Stop gracefully stops the application.
func (a *App) Stop() error {
    // çœç•¥ä»£ç ...
}
</code></pre>
<h3 id="3-è°ƒç”¨-run-æ–¹æ³•httpsgo-kratosdevbloggo-layout-operation-process3-è°ƒç”¨-run-æ–¹æ³•">3. è°ƒç”¨ Run() æ–¹æ³•<a href="https://go-kratos.dev/blog/go-layout-operation-process/#3-%e8%b0%83%e7%94%a8-run-%e6%96%b9%e6%b3%95" target="_blank">#</a></h3>
<p>é¡¹ç›®åœ¨ main æ–¹æ³•ä¸­è°ƒç”¨äº† <strong>kratos.App struct</strong> çš„ <strong>Run()</strong> æ–¹æ³•.</p>
<pre><code class="language-go">// helloword/cmd/main.go
// çœç•¥ä»£ç ...
// å¯åŠ¨ Kratos
if err := app.Run(); err != nil {
    panic(err)
}
</code></pre>
<p><strong>Run()</strong> æ–¹æ³•çš„å®ç°ç»†èŠ‚</p>
<pre><code class="language-go">// go-kratos/kratos/v2/app.go
func (a *App) Run() error {
    a.log.Infow(
        &quot;service_id&quot;, a.opts.id,
        &quot;service_name&quot;, a.opts.name,
        &quot;version&quot;, a.opts.version,
    )
    g, ctx := errgroup.WithContext(a.ctx)
        // éå†é€šè¿‡ kratos.Server() å£°æ˜çš„æœåŠ¡å®ä¾‹
    for _, srv := range a.opts.servers {
        srv := srv
                // æ‰§è¡Œä¸¤ä¸ªgoroutine, ç”¨äºå¤„ç†æœåŠ¡å¯åŠ¨å’Œé€€å‡º
        g.Go(func() error {
            &lt;-ctx.Done() // é˜»å¡,ç­‰å¾…è°ƒç”¨ cancel æ–¹æ³•
            return srv.Stop() // åç¨‹é€€å‡ºå,è°ƒç”¨å®ä¾‹çš„åœæ­¢æ–¹æ³•
        })
        g.Go(func() error {
            return srv.Start() // è°ƒç”¨å®ä¾‹çš„è¿è¡Œæ–¹æ³•
        })
    }
        // åˆ¤æ–­æ˜¯å¦è°ƒç”¨ kratos.Registrar() é…ç½®äº†æ³¨å†Œå‘ç°ä¸­å¿ƒ
    if a.opts.registrar != nil {
        // å°†å®ä¾‹æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ
        if err := a.opts.registrar.Register(a.opts.ctx, a.instance); err != nil 
            return err
        }
    }
        // ç›‘å¬è¿›ç¨‹é€€å‡ºä¿¡å·
    c := make(chan os.Signal, 1)
    signal.Notify(c, a.opts.sigs...)
        
        // å¤„ç†è¿›ç¨‹é€€å‡ºå’Œ context é€€å‡º
    g.Go(func() error {
        for {
            select {
            case &lt;-ctx.Done():
                return ctx.Err()
            case &lt;-c:
                        // è°ƒç”¨ kratos.App çš„åœæ­¢æ–¹æ³•
                a.Stop()
            }
        }
    })
    if err := g.Wait(); err != nil &amp;&amp; !errors.Is(err, context.Canceled) {
        return err
    }
    return nil
}
</code></pre>
<h3 id="4-åº”ç”¨é€€å‡º">4. åº”ç”¨é€€å‡º</h3>
<p>Kratos å®ä¾‹åœ¨å¯åŠ¨æ—¶,ç›‘å¬äº†ç³»ç»Ÿçš„è¿›ç¨‹é€€å‡ºä¿¡å·,å½“æ”¶åˆ°é€€å‡ºä¿¡å·æ—¶,kratos ä¼šè°ƒç”¨ <strong>App struct</strong> çš„ <strong>Stop()</strong> æ–¹æ³•</p>
<pre><code class="language-go">// go-kratos/kratos/v2/app.go
func (a *App) Stop() error {
    // åˆ¤æ–­æ˜¯å¦æœ‰æ³¨å†Œä¸­å¿ƒé…ç½®
    if a.opts.registrar != nil {
        // åœ¨æ³¨å†Œä¸­å¿ƒä¸­å°†å®ä¾‹æ³¨é”€
        if err := a.opts.registrar.Deregister(a.opts.ctx, a.instance); err != nil {
            return err
        }
    }
    // æ§åˆ¶ goroutine çš„é€€å‡º,å½“è°ƒç”¨ a.cancel()æ—¶,Run()æ–¹æ³•ä¸­ ç›‘å¬çš„ &lt;-ctx.Done() æ”¶åˆ°æ¶ˆæ¯å,æ²¡æœ‰é˜»å¡å,æ–¹æ³•ä¼šè°ƒç”¨ server çš„ Stop()æ–¹æ³•,åœæ­¢æœåŠ¡
    if a.cancel != nil {
        a.cancel()
    }
    return nil
}
</code></pre>
<h2 id="æ–‡ç« è½¬è‡ª">æ–‡ç« è½¬è‡ªï¼š</h2>
<ul>
<li><a href="https://go-kratos.dev/blog/go-layout-operation-process/" target="_blank">https://go-kratos.dev/blog/go-layout-operation-process/</a></li>
</ul>
<hr>
<p><img class="img-zoomable" src="/images/2344773-20210902225224456-315933124.png" alt="" />
</p>
<p><img class="img-zoomable" src="/images/2344773-20210902225203602-1750987546.gif" alt="" />
</p>

    </div>
</article>


<div class="license markdown-body">
    <blockquote>
        <p>é™¤ç‰¹æ®Šæ³¨æ˜éƒ¨åˆ†ï¼Œæœ¬ç«™å†…å®¹é‡‡ç”¨ <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"
               target="_blank">CC BY-NC-SA 4.0</a> è¿›è¡Œè®¸å¯ã€‚</p>
    </blockquote>
</div>


<div class="post-comment" data-comment="utterances">
    <span class="post-comment-notloaded">
        <i class="iconfont icon-chatbox-ellipses-sharp"></i>&nbsp;æŸ¥çœ‹è¯„è®º
    </span>
    <script>
        function loadComment() {
            var commentArea = document.querySelector('.post-comment');
            var utterancesTheme = document.body.getAttribute('data-theme');
            if (utterancesTheme === 'auto') {
                utterancesTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'photon-dark' :
                    'github-light';
            } else {
                utterancesTheme = utterancesTheme === 'dark' ? 'photon-dark' : 'github-light';
            }
            var s = document.createElement('script');
            s.src = 'https://utteranc.es/client.js';
            s.setAttribute('repo', 'haiyux\/haiyux.github.io');
            s.setAttribute('issue-term', 'pathname');
            s.setAttribute('theme', utterancesTheme);
            s.setAttribute('crossorigin', 'anonymous');
            s.setAttribute('async', '');
            document.querySelector('.post-comment').appendChild(s);
            document.querySelector('span.post-comment-notloaded').setAttribute('style', 'display: none;');
        }
    </script>
</div>


            </div>
            <aside class="col-12 col-md-3 float-left sidebar">
    
    <div class="sidebar-item sidebar-pages">
        <h3>é¡µé¢</h3>
        <ul>
            
            <li>
                <a href="/">ä¸»é¡µ</a>
            </li>
            
            <li>
                <a href="/archives/">æ–‡ç« </a>
            </li>
            
            <li>
                <a href="/about/">å…³äº</a>
            </li>
            
            <li>
                <a href="/search/">æœç´¢</a>
            </li>
            
            <li>
                <a href="/index.xml">RSS</a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>é“¾æ¥</h3>
        <ul>
            
            <li>
                <a href="https://github.com/haiyux" target="_blank"><span>GitHub</span></a>
            </li>
            
            <li>
                <a href="https://go-kratos.dev" target="_blank"><span>Kratos</span></a>
            </li>
            
            <li>
                <a href="mailto:haiyux@foxmail.com" target="_blank"><span>Email</span></a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>æ ‡ç­¾</h3>
        <div>
            
            <span>
                <a href="/tags/ddd/">DDD</a>
            </span>
            
            <span>
                <a href="/tags/docker/">docker</a>
            </span>
            
            <span>
                <a href="/tags/golang/">golang</a>
            </span>
            
            <span>
                <a href="/tags/grpc/">grpc</a>
            </span>
            
            <span>
                <a href="/tags/http/">http</a>
            </span>
            
            <span>
                <a href="/tags/kratos/">kratos</a>
            </span>
            
            <span>
                <a href="/tags/makefile/">makefile</a>
            </span>
            
            <span>
                <a href="/tags/mq/">mq</a>
            </span>
            
            <span>
                <a href="/tags/mysql/">mysql</a>
            </span>
            
            <span>
                <a href="/tags/nginx/">nginx</a>
            </span>
            
            <span>
                <a href="/tags/protobuf/">protobuf</a>
            </span>
            
            <span>
                <a href="/tags/raft/">raft</a>
            </span>
            
            <span>
                <a href="/tags/redis/">redis</a>
            </span>
            
            <span>
                <a href="/tags/thrift/">Thrift</a>
            </span>
            
            <span>
                <a href="/tags/traceing/">traceing</a>
            </span>
            
            <span>
                <a href="/tags/wire/">wire</a>
            </span>
            
            <span>
                <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">å¾®æœåŠ¡</a>
            </span>
            
            <span>
                <a href="/tags/%E6%B3%9B%E5%9E%8B/">æ³›å‹</a>
            </span>
            
            <span>
                <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a>
            </span>
            
            <span>
                <a href="/tags/%E8%BF%90%E7%BB%B4/">è¿ç»´</a>
            </span>
            
        </div>
    </div>
    <div class="sidebar-item sidebar-toc">
        <h3>ç›®å½•</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</a></li>
    <li><a href="#è¿è¡Œé¡¹ç›®">è¿è¡Œé¡¹ç›®</a></li>
    <li><a href="#åº”ç”¨æ˜¯å¦‚ä½•è·‘èµ·æ¥çš„">åº”ç”¨æ˜¯å¦‚ä½•è·‘èµ·æ¥çš„?</a>
      <ul>
        <li><a href="#1-æ³¨å…¥ä¾èµ–å¹¶è°ƒç”¨-newapp-æ–¹æ³•">1. æ³¨å…¥ä¾èµ–å¹¶è°ƒç”¨ newApp() æ–¹æ³•</a></li>
        <li><a href="#2-åˆ›å»º-kratos-å®ä¾‹">2. åˆ›å»º kratos å®ä¾‹</a></li>
        <li><a href="#3-è°ƒç”¨-run-æ–¹æ³•httpsgo-kratosdevbloggo-layout-operation-process3-è°ƒç”¨-run-æ–¹æ³•">3. è°ƒç”¨ Run() æ–¹æ³•<a href="https://go-kratos.dev/blog/go-layout-operation-process/#3-%E8%B0%83%E7%94%A8-run-%E6%96%B9%E6%B3%95">#</a></a></li>
        <li><a href="#4-åº”ç”¨é€€å‡º">4. åº”ç”¨é€€å‡º</a></li>
      </ul>
    </li>
    <li><a href="#æ–‡ç« è½¬è‡ª">æ–‡ç« è½¬è‡ªï¼š</a></li>
  </ul>
</nav></div>
</aside>

        </div>
        <div class="btn">
    <div class="btn-menu" id="btn-menu">
        <i class="iconfont icon-grid-sharp"></i>
    </div>
    <div class="btn-toggle-mode">
        <i class="iconfont icon-contrast-sharp"></i>
    </div>
    <div class="btn-scroll-top">
        <i class="iconfont icon-chevron-up-circle-sharp"></i>
    </div>
</div>
<aside class="sidebar-mobile" style="display: none;">
  <div class="sidebar-wrapper">
    
    <div class="sidebar-item sidebar-pages">
        <h3>é¡µé¢</h3>
        <ul>
            
            <li>
                <a href="/">ä¸»é¡µ</a>
            </li>
            
            <li>
                <a href="/archives/">æ–‡ç« </a>
            </li>
            
            <li>
                <a href="/about/">å…³äº</a>
            </li>
            
            <li>
                <a href="/search/">æœç´¢</a>
            </li>
            
            <li>
                <a href="/index.xml">RSS</a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-links">
        <h3>é“¾æ¥</h3>
        <ul>
            
            <li>
                <a href="https://github.com/haiyux" target="_blank"><span>GitHub</span></a>
            </li>
            
            <li>
                <a href="https://go-kratos.dev" target="_blank"><span>Kratos</span></a>
            </li>
            
            <li>
                <a href="mailto:haiyux@foxmail.com" target="_blank"><span>Email</span></a>
            </li>
            
        </ul>
    </div>
    
    <div class="sidebar-item sidebar-tags">
        <h3>æ ‡ç­¾</h3>
        <div>
            
            <span>
                <a href="/tags/ddd/">DDD</a>
            </span>
            
            <span>
                <a href="/tags/docker/">docker</a>
            </span>
            
            <span>
                <a href="/tags/golang/">golang</a>
            </span>
            
            <span>
                <a href="/tags/grpc/">grpc</a>
            </span>
            
            <span>
                <a href="/tags/http/">http</a>
            </span>
            
            <span>
                <a href="/tags/kratos/">kratos</a>
            </span>
            
            <span>
                <a href="/tags/makefile/">makefile</a>
            </span>
            
            <span>
                <a href="/tags/mq/">mq</a>
            </span>
            
            <span>
                <a href="/tags/mysql/">mysql</a>
            </span>
            
            <span>
                <a href="/tags/nginx/">nginx</a>
            </span>
            
            <span>
                <a href="/tags/protobuf/">protobuf</a>
            </span>
            
            <span>
                <a href="/tags/raft/">raft</a>
            </span>
            
            <span>
                <a href="/tags/redis/">redis</a>
            </span>
            
            <span>
                <a href="/tags/thrift/">Thrift</a>
            </span>
            
            <span>
                <a href="/tags/traceing/">traceing</a>
            </span>
            
            <span>
                <a href="/tags/wire/">wire</a>
            </span>
            
            <span>
                <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">å¾®æœåŠ¡</a>
            </span>
            
            <span>
                <a href="/tags/%E6%B3%9B%E5%9E%8B/">æ³›å‹</a>
            </span>
            
            <span>
                <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a>
            </span>
            
            <span>
                <a href="/tags/%E8%BF%90%E7%BB%B4/">è¿ç»´</a>
            </span>
            
        </div>
    </div>
    
    
    
    <div class="sidebar-item sidebar-toc">
        <h3>ç›®å½•</h3>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#åˆ›å»ºé¡¹ç›®">åˆ›å»ºé¡¹ç›®</a></li>
    <li><a href="#è¿è¡Œé¡¹ç›®">è¿è¡Œé¡¹ç›®</a></li>
    <li><a href="#åº”ç”¨æ˜¯å¦‚ä½•è·‘èµ·æ¥çš„">åº”ç”¨æ˜¯å¦‚ä½•è·‘èµ·æ¥çš„?</a>
      <ul>
        <li><a href="#1-æ³¨å…¥ä¾èµ–å¹¶è°ƒç”¨-newapp-æ–¹æ³•">1. æ³¨å…¥ä¾èµ–å¹¶è°ƒç”¨ newApp() æ–¹æ³•</a></li>
        <li><a href="#2-åˆ›å»º-kratos-å®ä¾‹">2. åˆ›å»º kratos å®ä¾‹</a></li>
        <li><a href="#3-è°ƒç”¨-run-æ–¹æ³•httpsgo-kratosdevbloggo-layout-operation-process3-è°ƒç”¨-run-æ–¹æ³•">3. è°ƒç”¨ Run() æ–¹æ³•<a href="https://go-kratos.dev/blog/go-layout-operation-process/#3-%E8%B0%83%E7%94%A8-run-%E6%96%B9%E6%B3%95">#</a></a></li>
        <li><a href="#4-åº”ç”¨é€€å‡º">4. åº”ç”¨é€€å‡º</a></li>
      </ul>
    </li>
    <li><a href="#æ–‡ç« è½¬è‡ª">æ–‡ç« è½¬è‡ªï¼š</a></li>
  </ul>
</nav>
    </div>
    
    
  </div>
</aside>
    </main>

    <footer>
    <div class="container-lg clearfix">
        <div class="col-12 footer">
            
            <span>&copy; 2019-2022
                <a href="https://www.zhaohaiyu.com">haiyux</a>
                 | <a href="https://www.zhaohaiyu.com">Source code</a> 
                | åŸºäº <a href="https://github.com/dsrkafuu/hugo-theme-fuji/"
                   target="_blank">Fuji-v2</a> &amp; <a href="https://gohugo.io/"
                                                    target="_blank">Hugo</a> æ„å»º
            </span>
        </div>
    </div>
</footer>

    
<script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.27.0/components/prism-core.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/prismjs@1.27.0/plugins/autoloader/prism-autoloader.min.js"></script>



<script defer src="/assets/js/fuji.min.js"></script>



</body>

</html>
